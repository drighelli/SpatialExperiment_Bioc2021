<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>2. The SpatialExperiment class • SpatialExperimentBioc2021</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="2. The SpatialExperiment class">
<meta property="og:description" content="SpatialExperimentBioc2021">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">SpatialExperimentBioc2021</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Introduction.html">1. Introduction to Spatial Transcriptomics</a>
    </li>
    <li>
      <a href="../articles/STexampleData.html">3. The STexampleData package</a>
    </li>
    <li>
      <a href="../articles/SpatialExperiment.html">2. The SpatialExperiment class</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/drighelli/SpatialExperiment_Bioc2021">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="SpatialExperiment_files/header-attrs-2.9/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>2. The SpatialExperiment class</h1>
                        <h4 class="author">Helena L. Crowell</h4>
            <address class="author_afil">
      Department of Molecular Life Sciences, University of Zurich, Zurich, Switzerland<br><a class="author_email" href="mailto:#"></a><a href="mailto:helena.crowell@uzh.ch" class="email">helena.crowell@uzh.ch</a>
      </address>
                  
      
      <small class="dont-index">Source: <a href="https://github.com/drighelli/SpatialExperiment_Bioc2021/blob/master/vignettes/SpatialExperiment.Rmd"><code>vignettes/SpatialExperiment.Rmd</code></a></small>
      <div class="hidden name"><code>SpatialExperiment.Rmd</code></div>

    </div>

    
    
<style type="text/css"> .smaller { font-size: 10px } </style>
<div id="reading-10x-visium-data" class="section level1">
<h1 class="hasAnchor">
<a href="#reading-10x-visium-data" class="anchor"></a>Reading 10X Visium data</h1>
<p>The 10X Genomics’ <em>CellRanger</em> pipeline will process data using standard output file formats that are saved, for each sample, in a single directory <code>/&lt;sample&gt;/outs/</code> of the following structure:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">sample</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="kw">|</span><span class="ex">—outs</span> </span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="ex">··</span><span class="kw">|</span><span class="ex">—raw/filtered_feature_bc_matrix.h5</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="ex">··</span><span class="kw">|</span><span class="ex">—raw/filtered_feature_bc_matrix</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="ex">····</span><span class="kw">|</span><span class="ex">—barcodes.tsv</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="ex">····</span><span class="kw">|</span><span class="ex">—features.tsv</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="ex">····</span><span class="kw">|</span><span class="ex">—matrix.mtx</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="ex">··</span><span class="kw">|</span><span class="ex">—spatial</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="ex">····</span><span class="kw">|</span><span class="ex">—tissue_hires_image.png</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="ex">····</span><span class="kw">|</span><span class="ex">—tissue_lowres_image.png</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="ex">····</span><span class="kw">|</span><span class="ex">—detected_tissue_image.jpg</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="ex">····</span><span class="kw">|</span><span class="ex">—aligned_fiducials.jpg</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="ex">····</span><span class="kw">|</span><span class="ex">—scalefactors_json.json</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="ex">····</span><span class="kw">|</span><span class="ex">—tissue_positions_list.csv</span></span></code></pre></div>
<p>The <code>SpatialExperiment</code> package provides an exemplary 10X Visium spatial gene expression data of two serial mouse brain sections (Sagittal-Posterior) available from the <a href="https://support.10xgenomics.com/spatial-gene-expression/datasets">10X Genomics website</a>. These are located in the <code>extdata/10xVisium</code> directory:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">SpatialExperiment</span><span class="op">)</span>

<span class="va">dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"10xVisium"</span><span class="op">)</span>,
  package <span class="op">=</span> <span class="st">"SpatialExperiment"</span><span class="op">)</span>

<span class="va">sample_ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"section1"</span>, <span class="st">"section2"</span><span class="op">)</span>
<span class="va">samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">dir</span>, <span class="va">sample_ids</span><span class="op">)</span></code></pre></div>
<p>We can load these data into a <code>SpatialExperiment</code> using the <code><a href="https://rdrr.io/pkg/SpatialExperiment/man/read10xVisium.html">read10xVisium()</a></code> function, which will read in all relevant information, including the count data, spatial metadata and coordinates, scale factors, and images:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span><span class="va">samples</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "raw_feature_bc_matrix" "spatial"</code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">samples</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="st">"spatial"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "scalefactors_json.json"    "tissue_lowres_image.png"  
## [3] "tissue_positions_list.csv"</code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span><span class="va">spe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SpatialExperiment/man/read10xVisium.html">read10xVisium</a></span><span class="op">(</span><span class="va">samples</span>, <span class="va">sample_ids</span>,
  type <span class="op">=</span> <span class="st">"sparse"</span>,   <span class="co"># use sparse (not HDF5) format</span>
  data <span class="op">=</span> <span class="st">"raw"</span>,      <span class="co"># read all (not filtered) data</span>
  images <span class="op">=</span> <span class="st">"lowres"</span>, <span class="co"># specify which image(s) to include</span>
  load <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>      <span class="co"># specify whether or not to load image(s)</span></code></pre></div>
<pre><code>## class: SpatialExperiment 
## dim: 50 99 
## metadata(0):
## assays(1): counts
## rownames(50): ENSMUSG00000051951 ENSMUSG00000089699 ...
##   ENSMUSG00000005886 ENSMUSG00000101476
## rowData names(1): symbol
## colnames(99): AAACAACGAATAGTTC-1 AAACAAGTATCTCCCA-1 ...
##   AAAGTCGACCCTCAGT-1 AAAGTGCCATCAATTA-1
## colData names(1): sample_id
## reducedDimNames(0):
## mainExpName: NULL
## altExpNames(0):
## spatialData names(3) : in_tissue array_row array_col
## spatialCoords names(2) : pxl_col_in_fullres pxl_row_in_fullres
## imgData names(4): sample_id image_id data scaleFactor</code></pre>
</div>
<div id="the-spatialexperiment-class" class="section level1">
<h1 class="hasAnchor">
<a href="#the-spatialexperiment-class" class="anchor"></a>The <code>SpatialExperiment</code> class</h1>
<div id="spatialdata--coords" class="section level2">
<h2 class="hasAnchor">
<a href="#spatialdata--coords" class="anchor"></a><code>spatialData</code> &amp; <code>-Coords</code>
</h2>
<p>Spatial metadata are stored inside the <code>int_colData</code>’s <code>spatialData</code> field as a <code>DataFrame</code> and include:</p>
<ul>
<li>
<code>in_tissue</code> indicating whether an observation was mapped to tissue</li>
<li>
<code>array_row/col</code> giving the spots’ row/column coordinate in the array<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>
</li>
</ul>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SpatialExperiment/man/SpatialExperiment-methods.html">spatialData</a></span><span class="op">(</span><span class="va">spe</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## DataFrame with 6 rows and 3 columns
##                    in_tissue array_row array_col
##                    &lt;logical&gt; &lt;integer&gt; &lt;integer&gt;
## AAACAACGAATAGTTC-1     FALSE         0        16
## AAACAAGTATCTCCCA-1      TRUE        50       102
## AAACAATCTACTAGCA-1      TRUE         3        43
## AAACACCAATAACTGC-1      TRUE        59        19
## AAACAGAGCGACTCCT-1      TRUE        14        94
## AAACAGCTTTCAGAAG-1     FALSE        43         9</code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># tabulate number of spots mapped to tissue</span>
<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span>
    sample_id <span class="op">=</span> <span class="va">spe</span><span class="op">$</span><span class="va">sample_id</span>,
    in_tissue <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/SpatialExperiment/man/SpatialExperiment-methods.html">spatialData</a></span><span class="op">(</span><span class="va">spe</span><span class="op">)</span><span class="op">$</span><span class="va">in_tissue</span><span class="op">)</span></code></pre></div>
<pre><code>##           in_tissue
## sample_id  FALSE TRUE
##   section1    28   22
##   section2    27   22</code></pre>
<p>A numeric matrix of spatial coordinates (here, x and y) is stored inside the <code>int_colData</code>’s <code>spatialCoords</code> field, and can be accessed using the <code><a href="https://rdrr.io/pkg/SpatialExperiment/man/SpatialExperiment-methods.html">spatialCoords()</a></code> accessor:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SpatialExperiment/man/SpatialExperiment-methods.html">spatialCoords</a></span><span class="op">(</span><span class="va">spe</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>##                    pxl_col_in_fullres pxl_row_in_fullres
## AAACAACGAATAGTTC-1               1252               2312
## AAACAAGTATCTCCCA-1               7237               8230
## AAACAATCTACTAGCA-1               1611               4170
## AAACACCAATAACTGC-1               8315               2519
## AAACAGAGCGACTCCT-1               2927               7679
## AAACAGCTTTCAGAAG-1               6400               1831</code></pre>
<p>Note that the <code>colData</code>, <code>spatialData</code>, and <code>spatialCoords</code> slots follow a hierarchical structure where <code>colData</code> &gt; <code>spatialData</code> &gt; <code>spatialCoords</code>. Here, each accessor function allows joint accession of the target slot, and (optionally) any slot(s) that precedes it.</p>
<p>Specifically, the following commands are supported may be used to access specific subsets of (spatial) metadata associated with each column (observation, e.g. spots or cells) in a SPE:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/SpatialExperiment/man/SpatialExperiment-methods.html">spatialCoords</a></span><span class="op">(</span><span class="va">spe</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/SpatialExperiment/man/SpatialExperiment-methods.html">spatialData</a></span><span class="op">(</span><span class="va">spe</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/SpatialExperiment/man/SpatialExperiment-methods.html">spatialData</a></span><span class="op">(</span><span class="va">spe</span>, spatialCoords <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/SpatialExperiment/man/SpatialExperiment-colData.html">colData</a></span><span class="op">(</span><span class="va">spe</span>, spatialData <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/SpatialExperiment/man/SpatialExperiment-colData.html">colData</a></span><span class="op">(</span><span class="va">spe</span>, spatialCoords <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/SpatialExperiment/man/SpatialExperiment-colData.html">colData</a></span><span class="op">(</span><span class="va">spe</span>, spatialData <span class="op">=</span> <span class="cn">TRUE</span>, spatialCoords <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
</div>
<div id="imgdata" class="section level2">
<h2 class="hasAnchor">
<a href="#imgdata" class="anchor"></a><code>imgData</code>
</h2>
<p>Image-related data are stored in the <code>int_metadata</code>’s <code>imgData</code> field as a <code>DataFrame</code> with the following columns:</p>
<ul>
<li>
<code>sample_id</code> and <code>image_id</code> specifying the image’s sample and image identifier</li>
<li>
<code>data</code> is a list of <code>SpatialImage</code>s containing the image’s <code>grob</code>, path and/or URL</li>
<li>
<code>scaleFactor</code>s are used to rescale spatial coordinates according to the image’s resolution</li>
</ul>
<p>We can retrieve these data using the <code><a href="https://rdrr.io/pkg/SpatialExperiment/man/SpatialExperiment-methods.html">imgData()</a></code> accessor:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/SpatialExperiment/man/SpatialExperiment-methods.html">imgData</a></span><span class="op">(</span><span class="va">spe</span><span class="op">)</span></code></pre></div>
<pre><code>## DataFrame with 2 rows and 4 columns
##     sample_id    image_id   data scaleFactor
##   &lt;character&gt; &lt;character&gt; &lt;list&gt;   &lt;numeric&gt;
## 1    section1      lowres   ####   0.0510334
## 2    section2      lowres   ####   0.0510334</code></pre>
</div>
</div>
<div id="the-spatialimage-class" class="section level1">
<h1 class="hasAnchor">
<a href="#the-spatialimage-class" class="anchor"></a>The <code>SpatialImage</code> class</h1>
<p>Images inside a <code>SpatialExperiment</code>’s <code>imgData</code> are stored as objects of class <code>SpatialImage</code>. The <code>SpatialImage</code> class hierarchy provides representations of images from a variety of sources, including:</p>
<ul>
<li>
<code>LoadedSpatialImage</code>: an image that is fully realized into memory, where the raster representation is stored inside the output object.</li>
<li>
<code>RemoteSpatialImage</code>: an image that is remotely hosted and retrieved only on request.</li>
<li>
<code>StoredSpatialImage</code>: an image that is stored in a local file and is loaded into memory only on request.</li>
</ul>
<p>A list of <code>SpatialImage</code>s can be retrieved from the <code>imgData</code>’s <code>data</code> field using the <code><a href="https://rdrr.io/r/base/Extract.html">$</a></code> accessor:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/SpatialExperiment/man/SpatialExperiment-methods.html">imgData</a></span><span class="op">(</span><span class="va">spe</span><span class="op">)</span><span class="op">$</span><span class="va">data</span></code></pre></div>
<pre><code>## [[1]]
## A 600 x 576 LoadedSpatialImage 
## 
## [[2]]
## A 600 x 576 LoadedSpatialImage</code></pre>
<p>For <code>StoredSpatialImage</code> and <code>RemoteSpatialImage</code> objects, loading the image with <code><a href="https://rdrr.io/pkg/SpatialExperiment/man/SpatialImage-class.html">imgRaster()</a></code> (see next section) will automatically store the loaded <code>raster</code> object in an in-memory cache. Any subsequent <code><a href="https://rdrr.io/pkg/SpatialExperiment/man/SpatialImage-class.html">imgRaster()</a></code> call will retrieve the <code>raster</code> from the cache, avoiding costly retrieval from the file system.</p>
<p>This provides the option to store an image’s source at minimal storage cost, which is desirable when multiple images are to be stored (say, for many samples and of different resolutions), or when a <code>SpatialExperiment</code> is to be exported.</p>
<div id="methods-for-image-handling" class="section level2">
<h2 class="hasAnchor">
<a href="#methods-for-image-handling" class="anchor"></a>Methods for image handling</h2>
<p>The <code>SpatialExperiment</code> package provides various functions to handle which and how image data is stored in the object. These include:</p>
<ul>
<li>
<code>get/add/rmvImg</code> to retrieve/add/remove (an) image(s) from a <code>SpatialExperiment</code>
</li>
<li>
<code>imgSource/Raster</code> to retrieve the path/URL or <code>raster</code> object associated with (an) image(s)</li>
</ul>
<p><code>get/rmvImg()</code> and <code>imgSource/Raster()</code> are flexible in the specification of the <code>sample/image_id</code> arguments. Specifically,</p>
<ul>
<li>
<code>TRUE</code> is equivalent to <em>all</em>, e.g. <code>sample_id = "&lt;sample&gt;", image_id = TRUE</code> will drop all images for a given sample.</li>
<li>
<code>NULL</code> defaults to the first entry available, e.g., <code>sample_id = "&lt;sample&gt;", image_id = NULL</code> will drop the first image for a given sample.</li>
</ul>
<p>For example, <code>sample_id,image_id = TRUE,TRUE</code> will specify all images; <code>NULL,NULL</code> corresponds to the first image entry in the <code>imgData</code>; <code>TRUE,NULL</code> equals the first image for all samples; and <code>NULL,TRUE</code> matches all images for the first sample.</p>
<div id="raster-source-accession" class="section level3">
<h3 class="hasAnchor">
<a href="#raster-source-accession" class="anchor"></a><code>raster</code> &amp; source accession</h3>
<p>Data available in an object of class <code>SpatialImage</code> may be accessed via the <code><a href="https://rdrr.io/pkg/SpatialExperiment/man/SpatialImage-class.html">imgRaster()</a></code> and <code><a href="https://rdrr.io/pkg/SpatialExperiment/man/SpatialImage-class.html">imgSource()</a></code> accessors. Note that, since our images are <code>LoadedSpatialImage</code>s, there source is <code>NA</code>:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">si</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SpatialExperiment/man/SpatialExperiment-methods.html">imgData</a></span><span class="op">(</span><span class="va">spe</span><span class="op">)</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SpatialExperiment/man/SpatialImage-class.html">imgRaster</a></span><span class="op">(</span><span class="va">si</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<pre><code>##      [,1]        [,2]        [,3]        [,4]       
## [1,] "#82847fff" "#81847fff" "#81847fff" "#81847fff"
## [2,] "#81847fff" "#81847fff" "#81847eff" "#81847fff"
## [3,] "#82847fff" "#82847fff" "#828580ff" "#81857fff"
## [4,] "#828580ff" "#82847fff" "#82857fff" "#82847fff"
## [5,] "#82847fff" "#828580ff" "#828580ff" "#828580ff"
## [6,] "#82857fff" "#828480ff" "#82847fff" "#828480ff"</code></pre>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/SpatialExperiment/man/SpatialImage-class.html">imgSource</a></span><span class="op">(</span><span class="va">si</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] NA</code></pre>
<p>Using <code><a href="https://rdrr.io/r/grDevices/as.raster.html">as.raster()</a></code> or, equivalently, the <code><a href="https://rdrr.io/pkg/SpatialExperiment/man/SpatialImage-class.html">imgRaster()</a></code> accessor, a <code>SpatialImage</code> may be converted to a <code>raster</code> object, which can be used directly for plotting:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">img1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/as.raster.html">as.raster</a></span><span class="op">(</span><span class="va">si</span><span class="op">)</span>
<span class="va">img2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SpatialExperiment/man/SpatialImage-class.html">imgRaster</a></span><span class="op">(</span><span class="va">si</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/identical.html">identical</a></span><span class="op">(</span><span class="va">img1</span>, <span class="va">img2</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">img1</span><span class="op">)</span></code></pre></div>
<p><img src="SpatialExperiment_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<p>In the example below, we access <em>all</em> images as <code>raster</code> objects (via setting <code>sample_id = image_id = TRUE</code>):</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">imgs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SpatialExperiment/man/SpatialImage-class.html">imgRaster</a></span><span class="op">(</span><span class="va">spe</span>, sample_id <span class="op">=</span> <span class="cn">TRUE</span>, image_id <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">imgs</span>, \<span class="op">(</span><span class="va">.</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span>, class <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>##       [,1]     [,2]    
## dim1  "600"    "600"   
## dim2  "576"    "576"   
## class "raster" "raster"</code></pre>
</div>
<div id="adding-removing-images" class="section level3">
<h3 class="hasAnchor">
<a href="#adding-removing-images" class="anchor"></a>Adding &amp; removing images</h3>
<p>Besides a path or URL to source the image from and a numeric scale factor, <code><a href="https://rdrr.io/pkg/SpatialExperiment/man/imgData-methods.html">addImg()</a></code> requires specification of the <code>sample_id</code> the new image belongs to, and an <code>image_id</code> that is not yet in use for that sample:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">url</span> <span class="op">&lt;-</span> <span class="st">"https://i.redd.it/3pw5uah7xo041.jpg"</span>
<span class="va">spe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SpatialExperiment/man/imgData-methods.html">addImg</a></span><span class="op">(</span><span class="va">spe</span>,
    sample_id <span class="op">=</span> <span class="st">"section1"</span>, 
    image_id <span class="op">=</span> <span class="st">"pomeranian"</span>,
    imageSource <span class="op">=</span> <span class="va">url</span>, 
    scaleFactor <span class="op">=</span> <span class="cn">NA_real_</span>, 
    load <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p>The above code chunk has added an new image entry in the input <code>SpatialExperiment</code>’s <code>imgData</code> field:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/SpatialExperiment/man/SpatialExperiment-methods.html">imgData</a></span><span class="op">(</span><span class="va">spe</span><span class="op">)</span></code></pre></div>
<pre><code>## DataFrame with 3 rows and 4 columns
##     sample_id    image_id   data scaleFactor
##   &lt;character&gt; &lt;character&gt; &lt;list&gt;   &lt;numeric&gt;
## 1    section1      lowres   ####   0.0510334
## 2    section2      lowres   ####   0.0510334
## 3    section1  pomeranian   ####          NA</code></pre>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">img</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SpatialExperiment/man/SpatialImage-class.html">imgRaster</a></span><span class="op">(</span><span class="va">spe</span>,
    sample_id <span class="op">=</span> <span class="st">"section1"</span>,
    image_id <span class="op">=</span> <span class="st">"pomeranian"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">img</span><span class="op">)</span></code></pre></div>
<p><img src="SpatialExperiment_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
<p>We can remove specific images with <code><a href="https://rdrr.io/pkg/SpatialExperiment/man/imgData-methods.html">rmvImg()</a></code>:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">spe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SpatialExperiment/man/imgData-methods.html">rmvImg</a></span><span class="op">(</span><span class="va">spe</span>,
    sample_id <span class="op">=</span> <span class="st">"section1"</span>,
    image_id <span class="op">=</span> <span class="st">"pomeranian"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/SpatialExperiment/man/SpatialExperiment-methods.html">imgData</a></span><span class="op">(</span><span class="va">spe</span><span class="op">)</span></code></pre></div>
<pre><code>## DataFrame with 2 rows and 4 columns
##     sample_id    image_id   data scaleFactor
##   &lt;character&gt; &lt;character&gt; &lt;list&gt;   &lt;numeric&gt;
## 1    section1      lowres   ####   0.0510334
## 2    section2      lowres   ####   0.0510334</code></pre>
</div>
</div>
</div>
<div id="sample_id-replacement" class="section level1">
<h1 class="hasAnchor">
<a href="#sample_id-replacement" class="anchor"></a><code>sample_id</code> replacement</h1>
<p>While storing of <code>sample_id</code>s inside the <code>SpatialExperiment</code>’s <code>colData</code> enables direct accessibility via the <code>colData</code> and <code><a href="https://rdrr.io/r/base/Extract.html">$</a></code> accessors, this field is protected against arbitrary modification. This affects operations to the following effects:</p>
<p>Empty replacement will retain sample identifiers:</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="va">spe</span><span class="op">$</span><span class="va">sample_id</span>
<span class="va">spe</span><span class="op">$</span><span class="va">sample_id</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>
<span class="fu"><a href="https://rdrr.io/r/base/identical.html">identical</a></span><span class="op">(</span><span class="va">tmp</span>, <span class="va">spe</span><span class="op">$</span><span class="va">sample_id</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>Replacement of <code>sample_id</code>s is permitted provided that</p>
<ol style="list-style-type: lower-roman">
<li>the number of unique sample identifiers is retained</li>
<li>newly provided sample identifiers are a one-to-one mapping</li>
</ol>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">spe</span><span class="op">$</span><span class="va">sample_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">spe</span><span class="op">)</span>, <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## Error in .local(x, ..., value): Number of unique 'sample_id's is 2, but 3 were provided.</code></pre>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">spe</span><span class="op">$</span><span class="va">sample_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"b"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">spe</span><span class="op">)</span>, <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## Error in .local(x, ..., value): New 'sample_id's must map uniquely</code></pre>
<p>Valid replacement will be propagated to the <code>imgData</code>:</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="va">spe</span>
<span class="va">i</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">spe</span><span class="op">$</span><span class="va">sample_id</span><span class="op">)</span><span class="op">)</span>
<span class="va">tmp</span><span class="op">$</span><span class="va">sample_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"sampleA"</span>, <span class="st">"sampleB"</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/pkg/SpatialExperiment/man/SpatialExperiment-methods.html">imgData</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">)</span></code></pre></div>
<pre><code>## DataFrame with 2 rows and 4 columns
##     sample_id    image_id   data scaleFactor
##   &lt;character&gt; &lt;character&gt; &lt;list&gt;   &lt;numeric&gt;
## 1     sampleA      lowres   ####   0.0510334
## 2     sampleB      lowres   ####   0.0510334</code></pre>
</div>
<div id="session-info" class="section level1 smaller">
<h1 class="hasAnchor">
<a href="#session-info" class="anchor"></a>Session info</h1>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## R version 4.1.0 (2021-05-18)
## Platform: x86_64-pc-linux-gnu (64-bit)
## Running under: Ubuntu 20.04.2 LTS
## 
## Matrix products: default
## BLAS/LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.8.so
## 
## locale:
##  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              
##  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    
##  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=C             
##  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 
##  [9] LC_ADDRESS=C               LC_TELEPHONE=C            
## [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       
## 
## attached base packages:
## [1] stats4    stats     graphics  grDevices utils     datasets  methods  
## [8] base     
## 
## other attached packages:
##  [1] SpatialExperiment_1.3.3     SingleCellExperiment_1.15.1
##  [3] SummarizedExperiment_1.23.1 Biobase_2.53.0             
##  [5] GenomicRanges_1.45.0        GenomeInfoDb_1.29.3        
##  [7] IRanges_2.27.0              S4Vectors_0.31.0           
##  [9] BiocGenerics_0.39.1         MatrixGenerics_1.5.2       
## [11] matrixStats_0.60.0         
## 
## loaded via a namespace (and not attached):
##  [1] Rcpp_1.0.7                locfit_1.5-9.4           
##  [3] lattice_0.20-44           rprojroot_2.0.2          
##  [5] digest_0.6.27             R6_2.5.0                 
##  [7] evaluate_0.14             highr_0.9                
##  [9] sparseMatrixStats_1.5.0   zlibbioc_1.39.0          
## [11] rlang_0.4.11              curl_4.3.2               
## [13] jquerylib_0.1.4           magick_2.7.2             
## [15] R.utils_2.10.1            R.oo_1.24.0              
## [17] Matrix_1.3-4              rmarkdown_2.9            
## [19] pkgdown_1.6.1             textshaping_0.3.5        
## [21] desc_1.3.0                BiocParallel_1.27.2      
## [23] stringr_1.4.0             RCurl_1.98-1.3           
## [25] beachmat_2.9.0            DelayedArray_0.19.1      
## [27] HDF5Array_1.21.0          compiler_4.1.0           
## [29] xfun_0.24                 DropletUtils_1.13.1      
## [31] systemfonts_1.0.2         htmltools_0.5.1.1        
## [33] GenomeInfoDbData_1.2.6    edgeR_3.35.0             
## [35] crayon_1.4.1              rhdf5filters_1.5.0       
## [37] bitops_1.0-7              R.methodsS3_1.8.1        
## [39] grid_4.1.0                jsonlite_1.7.2           
## [41] magrittr_2.0.1            dqrng_0.3.0              
## [43] stringi_1.7.3             cachem_1.0.5             
## [45] scuttle_1.3.0             XVector_0.33.0           
## [47] fs_1.5.0                  limma_3.49.1             
## [49] bslib_0.2.5.1             DelayedMatrixStats_1.15.0
## [51] ragg_1.1.3                Rhdf5lib_1.15.2          
## [53] rjson_0.2.20              tools_4.1.0              
## [55] parallel_4.1.0            fastmap_1.1.0            
## [57] yaml_2.2.1                rhdf5_2.37.0             
## [59] memoise_2.0.0             knitr_1.33               
## [61] sass_0.4.0</code></pre>
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p><code>array_row</code>s range from 0-77 (78 rows); <code>array_col</code>s are even in 0-126 for even rows, and odd in 1-127 for odd rows (64 columns), giving in <span class="math inline">\(78 \times 64 = 4,992\)</span> spots per sample.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Dario Righelli, Helena L Crowell, Lukas M Weber.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
